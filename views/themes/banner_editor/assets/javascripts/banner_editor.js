"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function e(n,o){this.$element=t(n),this.options=t.extend({},e.DEFAULTS,t.isPlainObject(o)&&o),this.init()}var n="qor.bannereditor",o="enable."+n,r="disable."+n,a="click."+n,i="dragstart."+n,d="dragend."+n,s="dragenter."+n,l="drop."+n,c="[draggable]",h=".qor-bottomsheets",u="qor-bottomsheets__mediabox",b=".qor-bannereditor__button",m=".qor-bannereditor__value",f=".qor-bannereditor__bg",p=".qor-bannereditor__toolbar-image",g=".qor-bannereditor__canvas";return e.prototype={constructor:e,init:function(){this.bind(),this.config={},this.$textarea=this.$element.find(m),this.config.toolbar=this.$textarea.data("configure"),this.$canvas=this.$element.find(g),this.initToolbar()},bind:function(){this.$element.on(a,b,this.addElements.bind(this)).on(a,p,this.openBottomSheets.bind(this)).on(i,c,this.handleDragStart.bind(this)).on(d,c,this.handleDragEnd.bind(this)).on(s,c,this.handleDragEnter.bind(this)).on(l,c,this.handleDrop.bind(this)),t(document).on(a,'.qor-bannereditor__content button[type="submit"]',this.renderElement.bind(this))},initToolbar:function(){var n=t(window.Mustache.render(e.toolbar,this.config));n.appendTo(t(".qor-bannereditor__toolbar-btns")),this.$popover=t(e.popover).appendTo("body")},initMedia:function(){var e=t(h).find("tbody tr"),n=void 0,o=void 0;e.each(function(){n=t(this),o=n.find(".qor-table--ml-slideout p img").first(),n.find(".qor-table__actions").remove(),o.length&&(n.find(".qor-table--medialibrary-item").css("background-image","url("+o.prop("src")+")"),o.parent().remove())})},openBottomSheets:function(e){var n=t(e.target).closest(p),o=n.data("banner-media-url");this.BottomSheets=t("body").data("qor.bottomsheets"),this.BottomSheets.open({url:o},this.handleBannerImage.bind(this))},handleBannerImage:function(){var e=t(h),n={onSelect:this.addBannerImage.bind(this),onSubmit:this.addBannerImage.bind(this)};e.qorSelectCore(n).addClass(u),this.initMedia()},addBannerImage:function(t){console.log(t);var e=t.MediaOption.OriginalURL?t.MediaOption:JSON.parse(t.MediaOption),n=e.OriginalURL,o='<div class="'+f.slice(1)+'" />',r=void 0;return this.$element.find(f).length||this.$canvas.wrapInner(o),r=this.$element.find(f),r.css("background-image","url("+n+")"),this.BottomSheets.hide(),!1},handleDragStart:function(e){e.originalEvent.dataTransfer.setData("text/plain",null),t(e.target).addClass("draging")},handleDragEnter:function(t){return t.stopPropagation(),t.preventDefault(),!1},handleDragEnd:function(e){console.log(e),t(e.target).css({left:e.originalEvent.clientX,top:e.originalEvent.clientY}),t(e.target).removeClass("draging")},handleDrop:function(t){return!1},renderElement:function(e){var n=t(e.target).closest("form"),o=n.prop("action"),r=n.prop("method"),a=new FormData(n[0]),i=this.$canvas,d=this.$textarea,s=this.$popover;if(n.length)return t.ajax(o,{method:r,dataType:"json",data:a,processData:!1,contentType:!1,success:function(e){i.append(t(e.Template).attr("draggable",!0)),d.val(i.html()),s.qorModal("hide")}}),!1},addElements:function(e){var n=t(e.target),o=n.data("banner-url"),r=n.data("title"),a=this.$popover;t.ajax(o,{method:"GET",dataType:"html",success:function(e){var n=t(e).find(".qor-form-container");n.find(".qor-button--cancel").attr("data-dismiss","modal").removeAttr("href"),a.find(".qor-bannereditor__title").html(r),a.find(".qor-bannereditor__content").html(n.html()),a.trigger("enable").qorModal("show")}})}},e.toolbar='[[#toolbar]]<button class="mdl-button mdl-button--colored mdl-js-button qor-bannereditor__button" data-banner-url="[[CreateUrl]]" data-title="[[Name]]" type="button">[[Name]]</button>[[/toolbar]]',e.popover='<div class="qor-modal fade qor-bannereditor__form" tabindex="-1" role="dialog" aria-hidden="true">\n                                  <div class="mdl-card mdl-shadow--2dp" role="document">\n                                    <div class="mdl-card__title">\n                                        <h2 class="mdl-card__title-text qor-bannereditor__title"></h2>\n                                    </div>\n                                    <div class="mdl-card__supporting-text qor-bannereditor__content"></div>\n                                  </div>\n                                </div>',e.plugin=function(o){return this.each(function(){var r=t(this),a=r.data(n),i=void 0;if(!a){if(/destroy/.test(o))return;r.data(n,a=new e(this,o))}"string"==typeof o&&t.isFunction(i=a[o])&&i.apply(a)})},t(function(){var n='[data-toggle="qor.bannereditor"]';t(document).on(r,function(o){e.plugin.call(t(n,o.target),"destroy")}).on(o,function(o){e.plugin.call(t(n,o.target))}).triggerHandler(o)}),e});